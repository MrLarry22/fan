# MySQL Database Files

This folder contains all MySQL database-related files for the Fanview platform migration.

## üìÅ Contents

### `schema.sql`
Complete MySQL database schema including:
- All 8 tables (users, profiles, creators, content, subscriptions, likes, messages, payment_transactions)
- Indexes for performance
- Foreign key constraints
- Automatic triggers
- Stored procedures
- Database views
- Full-text search indexes

## üöÄ Quick Setup

### Option 1: Run Installation Script (Recommended)
```powershell
cd d:\Downloads\1\project
powershell -ExecutionPolicy Bypass -File install-mysql-migration.ps1
```

### Option 2: Manual Installation

1. **Start MySQL**
```powershell
net start MySQL80
```

2. **Create Database**
```powershell
mysql -u root -p
```

3. **Import Schema**
```sql
SOURCE d:/Downloads/1/project/mysql/schema.sql;
```

4. **Verify**
```sql
USE fanview;
SHOW TABLES;
SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'fanview';
```

You should see 8 tables.

## üìä Database Schema

### Tables:
1. **users** - Authentication data
2. **profiles** - User profile information  
3. **creators** - Creator accounts
4. **content** - Media content
5. **subscriptions** - User subscriptions to creators
6. **likes** - Content likes
7. **messages** - Direct messaging
8. **payment_transactions** - Payment history

### Relationships:
```
users (1:1) profiles
profiles (1:1) creators
creators (1:Many) content
creators (1:Many) subscriptions
profiles (1:Many) subscriptions
profiles (1:Many) likes
content (1:Many) likes
profiles (1:Many) messages
```

## üîß Schema Features

### Automatic Triggers:
- **likes_count** - Auto-updates when likes added/removed
- **media_count** - Auto-updates when content added/removed
- **total_subscribers** - Auto-updates when subscriptions change
- **total_likes** - Auto-updates across creator profile

### Stored Procedures:
- **get_creator_stats(creator_id)** - Get complete creator statistics
- **check_subscription(user_id, creator_id)** - Check if user has active subscription

### Views:
- **creator_profiles_view** - Creators with user information
- **active_subscriptions_view** - Active subscriptions with details

### Indexes:
- Primary keys on all tables
- Foreign key indexes
- Composite indexes for common queries
- Full-text search on creators.display_name, creators.bio, content.title, content.description

## üíæ Backup & Restore

### Create Backup:
```powershell
mysqldump -u root -p fanview > backup_$(Get-Date -Format 'yyyyMMdd').sql
```

### Restore from Backup:
```powershell
mysql -u root -p fanview < backup_20251201.sql
```

## üîç Useful Queries

### Check Database Size:
```sql
SELECT 
  table_schema AS 'Database',
  ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)'
FROM information_schema.tables
WHERE table_schema = 'fanview'
GROUP BY table_schema;
```

### Check Table Row Counts:
```sql
SELECT 
  table_name,
  table_rows
FROM information_schema.tables
WHERE table_schema = 'fanview'
ORDER BY table_rows DESC;
```

### View Active Connections:
```sql
SHOW PROCESSLIST;
```

### Check Slow Queries:
```sql
SELECT * FROM mysql.slow_log
WHERE start_time > DATE_SUB(NOW(), INTERVAL 1 HOUR)
ORDER BY query_time DESC;
```

## üõ†Ô∏è Maintenance

### Optimize Tables:
```sql
OPTIMIZE TABLE users, profiles, creators, content, subscriptions;
```

### Analyze Tables (Update Statistics):
```sql
ANALYZE TABLE users, profiles, creators, content, subscriptions;
```

### Check Table Status:
```sql
SHOW TABLE STATUS FROM fanview;
```

## üîê Security

### Create Application User:
```sql
CREATE USER 'fanview_app'@'localhost' IDENTIFIED BY 'secure_password_here';
GRANT SELECT, INSERT, UPDATE, DELETE ON fanview.* TO 'fanview_app'@'localhost';
FLUSH PRIVILEGES;
```

Then update `.env`:
```env
MYSQL_USER=fanview_app
MYSQL_PASSWORD=secure_password_here
```

## üìö Additional Resources

- [MySQL Documentation](https://dev.mysql.com/doc/)
- [mysql2 Package Docs](https://www.npmjs.com/package/mysql2)
- [Migration Guide](../MYSQL_MIGRATION_COMPLETE_GUIDE.md)
- [Quick Start](../MYSQL_QUICK_START.md)
- [Architecture Diagram](../ARCHITECTURE_DIAGRAM.md)

## ‚ö†Ô∏è Important Notes

1. **Character Set:** All tables use `utf8mb4_unicode_ci` for full Unicode support
2. **Timestamps:** All timestamps are in UTC (`timezone = '+00:00'`)
3. **UUIDs:** Using CHAR(36) to store UUIDs generated by `UUID()` or Node.js
4. **Transactions:** Connection pool supports transactions with automatic rollback
5. **Connection Pooling:** Maximum 10 concurrent connections by default

## üêõ Troubleshooting

### "Access denied for user"
```sql
ALTER USER 'root'@'localhost' IDENTIFIED BY 'your_password';
FLUSH PRIVILEGES;
```

### "Unknown database 'fanview'"
```sql
CREATE DATABASE fanview CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### "Table already exists"
Drop and recreate:
```sql
DROP DATABASE fanview;
SOURCE d:/Downloads/1/project/mysql/schema.sql;
```

---

**Last Updated:** December 1, 2025  
**Version:** 1.0  
**Status:** Production Ready ‚úÖ
